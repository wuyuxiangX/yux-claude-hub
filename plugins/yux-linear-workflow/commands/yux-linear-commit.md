---
description: Stage and commit changes with Linear sync
---

# Linear Commit - Stage Changes

Make incremental commits during development, linking to Linear issue and syncing progress.

**Usage**: `/yux-linear-commit [description]`

## Input

Optional commit description (reference only, Claude auto-generates the message): $ARGUMENTS

## Workflow

### Step 1: Detect Current State

1. **Get current branch**:
   ```bash
   git branch --show-current
   ```

2. **Extract Linear issue ID** (LIN-xxx pattern)
   - If not on a Linear branch, prompt user to run `/yux-linear-start` first

3. **Read local state file**:
   - Path: `.claude/linear-tasks/<ISSUE_ID>.json`
   - Get issue_uuid for subsequent Linear API calls

4. **Check uncommitted changes**:
   ```bash
   git status --porcelain
   ```
   - If no changes, display "No changes to commit" and exit

### Step 2: Display Changed Files

Run `git status --porcelain` and categorize:

> Output language follows `.claude/yux-config.json` setting

```
=== Current Changes ===

New files (3):
   [1] src/components/Login.tsx
   [2] src/utils/auth.ts
   [3] tests/login.test.ts

Modified files (2):
   [4] src/App.tsx
   [5] package.json

Deleted files (1):
   [6] src/old-login.js

Suggested to ignore (not numbered):
   - .env.local (sensitive file)
   - .DS_Store (system file)
```

### Step 3: User Selects Files to Commit

Use AskUserQuestion tool to let user choose:

> Output language follows `.claude/yux-config.json` setting

```
Select files to commit:

1. Commit all changes (6 files)
2. Select specific files (enter numbers, e.g.: 1,2,4)
3. Exclude specific files (enter numbers to exclude, e.g.: -5,-6)
4. Cancel
```

### Step 3.5: Atomic Check

**Before generating commit message, analyze atomicity of changes**:

1. **Analyze changes**:
   - Read diff of selected files
   - Determine if changes contain multiple unrelated modifications

2. **If changes contain multiple independent features**, suggest splitting:

> Output language follows `.claude/yux-config.json` setting

```
Suggest splitting commit

Detected multiple independent changes:
1. UI changes: src/components/Login.tsx, src/App.tsx
2. API changes: src/api/auth.ts

Suggestion:
- First commit: UI files (select 1,2)
- Second commit: API files (select 3)

Split commit? (y/n to continue with current selection)
```

3. **If changes are atomic**, display confirmation and continue:
```
Atomic check passed (all changes belong to same feature)
```

### Step 4: Generate Commit Message

**Claude auto-generates commit message** (user input is reference only):

1. **Analyze changes**:
   - Read diff of selected files
   - Determine change type and scope

2. **Auto-determine commit message**:
   - `emoji`: Choose emoji based on type
   - `type`: feat/fix/docs/refactor/test/chore/style/perf
   - `scope`: Infer module from changed files (e.g., auth, ui, api)
   - `subject`: **Chinese** description, max 50 characters

3. **Emoji mapping**:

| Type | Emoji | Meaning |
|------|-------|---------|
| feat | ‚ú® | New feature |
| fix | üêõ | Bug fix |
| docs | üìù | Documentation |
| style | üíÑ | Format/style |
| refactor | ‚ôªÔ∏è | Refactoring |
| perf | ‚ö°Ô∏è | Performance |
| test | ‚úÖ | Tests |
| build | üì¶ | Build |
| ci | üë∑ | CI/CD |
| chore | üîß | Chores |

4. **Show generated commit message** for user confirmation:

> Output language follows `.claude/yux-config.json` setting

```
Generated commit message:

‚ú® feat(auth): add login component and auth utilities

**What**
- Add LoginForm.tsx component in `src/components`
- Add `auth.ts` authentication utility
- Update App.tsx to integrate login route

**Why**
Provide login entry for users and implement basic authentication flow.

Refs: LIN-456

**Who**
Co-Authored-By: wuyuxiang ü§ñ Generated by Claude AI

Confirm? (y/modify/n)
```

5. **Commit message format** (based on configured language):

   ```
   <emoji> <type>(<scope>): <subject in configured language>

   **What**
   - Change point 1
   - Change point 2

   **Why**
   Explain motivation

   Refs: LIN-xxx

   **Who**
   Co-Authored-By: <username> ü§ñ Generated by Claude AI
   ```

**Important rules**:
- Subject and body language must match the configured language
- Do NOT execute `git push`, only `git add` and `git commit`
- User manually executes `git push`

### Step 5: Execute Commit

1. **Stage selected files**:
   ```bash
   git add <file1> <file2> ...
   ```

2. **Create commit**:
   ```bash
   git commit -m "<message>"
   ```

3. **Display commit result**:

> Output language follows `.claude/yux-config.json` setting

```
Committed 4 files

Commit hash: abc1234
Message: feat(auth): add login component
Related Issue: LIN-456
```

### Step 6: Sync to Linear (Required)

After successful commit, **must** add comment to Linear issue:

```
mcp__linear__create_comment(
  issueId: "<issue-uuid>",
  body: "**Commit**: `abc1234`\n\n```\nfeat(auth): add login component\n```\n\n**Files changed**: 4\n- src/components/Login.tsx\n- src/utils/auth.ts\n- ..."
)
```

Display sync result:

```
Synced to Linear: LIN-456
```

### Step 7: Output Completion Summary

> Output language follows `.claude/yux-config.json` setting

```
=== Commit Complete ===

Commit hash: abc1234
Message: feat(auth): add login component
Files: 4
Linear: LIN-456

Next steps:
- Continue development
- /yux-linear-commit to commit again
- /yux-linear-pr to create PR
- git push (manual)
```

## Special File Handling

### Auto-suggested Ignore Patterns

| Pattern | Reason |
|---------|--------|
| `.env*` | Sensitive config |
| `*.local` | Local config |
| `node_modules/**` | Dependencies |
| `.DS_Store` | macOS system file |
| `Thumbs.db` | Windows system file |
| `*.log` | Log files |
| `credentials*` | Credential files |
| `*.key` | Key files |
| `*.pem` | Certificate files |
| `.claude/` | Claude config (except linear-tasks) |

### Handling

- These files shown in "Suggested to ignore" list
- Not auto-numbered, user must explicitly select to commit
- If user forces commit of sensitive files, show warning confirmation

## Error Handling

> All error messages output in configured language

### Not on Linear Branch
```
Not on a Linear branch

Current branch: main

Please run /yux-linear-start to create a task branch first.
```

### No Local State File
```
Local state file not found

Please run /yux-linear-status to sync state before committing.
```

### No Changes
```
No changes to commit

Working directory is clean.
```

### Commit Failed
```
Commit failed

Error: <git error message>

Please fix the issue and try again.
```

### Linear Sync Failed
```
Linear sync failed

Commit completed (abc1234), but failed to sync to Linear.
Error: <error message>

Please manually record this commit on Linear.
```

## Examples

> All examples show English output. Actual output follows configured language.

### Example 1: Standard Flow

```
User: /yux-linear-commit implement login form

Claude:
=== Current Changes ===

New files (1):
   [1] src/components/LoginForm.tsx

Modified files (2):
   [2] src/App.tsx
   [3] src/routes/index.ts

Select files to commit:
1. Commit all changes (3 files)
2. Select specific files
3. Exclude specific files
4. Cancel

User: 1

Claude:
‚úì Atomic check passed (all changes belong to same feature)

Generated commit message:

‚ú® feat(auth): add login form component and route integration

**What**
- Create `LoginForm.tsx` component for user login interface
- Update `App.tsx` to integrate login component
- Update `routes/index.ts` to add login route

**Why**
Provide login entry for users and implement basic authentication flow.

Refs: LIN-456

**Who**
Co-Authored-By: wuyuxiang ü§ñ Generated by Claude AI

Confirm? (y/modify/n)

User: y

Claude:
Committed 3 files
Synced to Linear: LIN-456

=== Commit Complete ===

Commit hash: a1b2c3d
Linear: LIN-456

Next steps:
- Continue development
- /yux-linear-commit to commit again
- /yux-linear-pr to create PR
- git push (manual)
```

### Example 2: Selective Commit

```
User: /yux-linear-commit

Claude:
=== Current Changes ===

New files (1):
   [1] src/utils/auth.ts

Modified files (3):
   [2] src/App.tsx
   [3] package.json
   [4] package-lock.json

Select files to commit:
...

User: 1,2

Claude:
‚úì Atomic check passed

Committed 2 files
Synced to Linear: LIN-456
...
```

### Example 3: Modify Commit Message

```
User: /yux-linear-commit

Claude:
...

Generated commit message:

‚ú® feat(auth): add login validation

Confirm? (y/modify/n)

User: change to fix type, fixing validation logic

Claude:
Modified commit message:

üêõ fix(auth): fix login validation logic

Confirm? (y/modify/n)

User: y

Claude:
Committed 2 files
...
```
